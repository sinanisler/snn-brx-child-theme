name: Sync Files

on:
  push:
    branches:
      - main
 
jobs:
  sync:
    runs-on: ubuntu-latest

    env:
      FILES_TO_SYNC: |
        includes/301-redirect.php
        includes/404-logging.php
        includes/accessibility-settings.php
        includes/activity-logs.php
        includes/cookie-banner.php
        includes/custom-code-snippets.php
        includes/custom-field-settings.php
        includes/post-types-settings.php
        includes/disable-emojis.php
        includes/disable-gravatar.php
        includes/disable-xmlrpc.php
        includes/disable-wp-json-if-not-logged-in.php
        includes/disable-bundled-theme-install.php
        includes/disable-file-editing.php
        includes/file-size-column-media.php
        includes/login-math-captcha.php
        includes/login-logo-change-url-change.php
        includes/login-settings.php
        includes/mail-logging.php
        includes/media-settings.php
        includes/media-image-opt.php
        includes/role-manager.php
        includes/search-loggins.php
        includes/smtp-settings.php
        includes/security-page.php
        includes/seo.php
        includes/taxonomy-settings.php
        includes/other-settings.php
        includes/remove-rss.php
        includes/remove-wp-version.php
        includes/block-editor-settings.php
        includes/wp-admin-dashboard-widgets.php  

        assets/js/gsap.min.js
        assets/js/ScrollTrigger.min.js
        assets/js/gsap-data-animate.js
        assets/js/lottie.min.js
        assets/js/snn-rich-text-editor.js
        assets/js/accessibility.min.js
        assets/js/canvas-to-blob.min.js
        assets/js/FileSaver.min.js
        assets/js/jszip.min.js
        assets/js/leaflet.js
        assets/js/lottie.min.js
        assets/js/markdown.min.js
        assets/js/pdf.min.js
        assets/js/pdf.worker.min.js
        assets/js/snn-accessibility.js
        assets/js/wavesurfer.esm.js

        assets/css/snn-rich-text-editor.css
        assets/css/leaflet.css

        includes/ai/ai-settings.php
        includes/ai/ai-api.php
        includes/ai/ai-overlay.php
        includes/ai/ai-seo-generation.php
        includes/ai/ai-block-editor.php
        includes/ai/ai-agent-and-chat.php

        includes/ai/abilities/ability-categories.php
        includes/ai/abilities/create-posts.php
        includes/ai/abilities/update-posts.php
        includes/ai/abilities/get-posts.php
        includes/ai/abilities/get-post-by-id.php
        includes/ai/abilities/get-post-meta.php
        includes/ai/abilities/search-content.php
        includes/ai/abilities/get-terms.php
        includes/ai/abilities/get-tags.php
        includes/ai/abilities/create-terms.php
        includes/ai/abilities/get-media.php
        includes/ai/abilities/get-users.php
        includes/ai/abilities/get-comments.php
        includes/ai/abilities/get-site-info.php
        includes/ai/abilities/suggest-content-ideas.php
        includes/ai/abilities/create-post-summaries.php
        includes/ai/abilities/check-seo-quality-title-and-content.php
        includes/ai/abilities/installed-plugin-list-and-infos.php
        includes/ai/abilities/active-theme-info.php
        includes/ai/abilities/list-taxonomies.php


    steps:
      - name: Checkout Source Repo
        uses: actions/checkout@v4
        with:
          path: source-repo
          fetch-depth: 0

      - name: Get Source Commit Info
        id: commit_info
        run: |
          cd source-repo
          COMMIT_MSG=$(git log -1 --pretty=%B)
          COMMIT_HASH=$(git log -1 --pretty=%h)
          COMMIT_AUTHOR=$(git log -1 --pretty=%an)
          echo "message=$COMMIT_MSG" >> $GITHUB_OUTPUT
          echo "hash=$COMMIT_HASH" >> $GITHUB_OUTPUT
          echo "author=$COMMIT_AUTHOR" >> $GITHUB_OUTPUT

      # Sync to sinanisler/snn-block
      - name: Checkout Destination Repo (snn-block)
        uses: actions/checkout@v4
        with:
          repository: sinanisler/snn-block
          path: destination-repo-block
          token: ${{ secrets.SNNBRXSYNCSECRET }}

      - name: Copy files to Destination Repo (snn-block)
        run: |
          for file_path in $FILES_TO_SYNC; do
            echo "Processing file: $file_path (snn-block)"
            mkdir -p "destination-repo-block/$(dirname "$file_path")"
            cp "source-repo/$file_path" "destination-repo-block/$file_path"
          done

      - name: Commit and Push Changes (snn-block)
        run: |
          cd destination-repo-block
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          if [[ -z $(git status --porcelain) ]]; then
            echo "No changes to commit."
            exit 0
          fi
          for file_path in $FILES_TO_SYNC; do
            git add "$file_path"
          done
          git commit -m "${{ steps.commit_info.outputs.message }}" -m ": ${{ steps.commit_info.outputs.hash }}"
          git push

 